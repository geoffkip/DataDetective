{% extends "layout.html" %}
{% block body %}
<br>
<br>
<br>

<div class="row" id="">
  <div class="col-md-5">
    <div class="form-group">
      <label for="measures">Measures</label>
      <select width="50%" class="form-control" id="measures-select" name="state" multiple="multiple">
        <option value="SNAP Individuals">SNAP Individuals</option>
        <option value="SNAP Dollars">SNAP Dollars</option>
        <option value="Jobs Created">Jobs Created</option>
        <option value="SNAP Individuals">SNAP Individuals</option>
        <option value="SNAP Dollars">SNAP Dollars</option>
        <option value="Jobs Created">Jobs Created</option>
      </select>
    </div>
  </div>
  <div class="col-md-2">
  </div>
  <div class="col-md-5">
    <label for="recommended-measures">Recommendedations</label>
    <br>
    <span class="badge badge-primary">SNAP Individuals</span>&nbsp;<span class="badge badge-primary">SNAP Dollars</span>&nbsp;<span class="badge badge-primary">Medicaid Population</span>
  </div>

</div>
<!-- <div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <div id="line-chart" style="min-width: 400px; height: 100px; margin: 0 auto"></div>
      </div>
    </div>
  </div>
</div> -->
<div class="row" id="geo-charts">

</div>

<script>
var charts = {}; // A list of charts on the page
/*
SAMPLE OF charts DATA STRUCTURE:
{
  "snap_individuals": {
    chart: chartObject,
    data: {
      "2017": {
        "01": [...],
        "02": [...],
        ...
        "12": [...]
      },
      "2016": {
        "01": [...],
        "02": [...],
        ...
        "12": [...]
      }
    }
  },
  "snap_dollars": {
    chart: chartObject,
    data {
      "2017": 4000000,
      "2016": 4000000
    }
  }
}


*/

$(document).ready(function() {
  // SETUP MEASURE SELECTION
  $('#measures-select').select2();
  $("#measures-select")
    .on('change', function (e) {
      var data = $('#measures-select').select2('data');
      var chartsCount = data.length;
      // Step 1: Fetch all the data for this measure

      // Step 2: Build the time-series of data

      // Step 3: Create the charts
      $("#geo-charts").empty();
      charts = {};
      layout = [12,6,4,6,4,4]
      minHeights = [500, 400, 300, 300, 300, 300]

      for(var i = 0; i < chartsCount; i++) {

        // TODO: Dynamically size the charts, dynamically resize the charts


        $("#geo-charts").append('<div id="chart'+(i+1)+'" class="col-md-'+layout[chartsCount-1]+'" style="min-height: '+minHeights[chartsCount-1]+'px; margin: 0 auto"></div>');
        var id = "chart"+ (i+1);
        var title = data[i].text;
        var chart = newGeoChart(id, title);
        charts[title.replace(' ', '_').toLowerCase()] = {
          chart: chart,
          data: {} // TODO populate with chart's data
        };

      }

      console.log(charts)

    })

});

// Create the chart
var newGeoChart = function(id, title) {
  var data = [
      ['us-pa-015', 0],
      ['us-pa-117', 1],
      ['us-pa-027', 2],
      ['us-pa-035', 3],
      ['us-pa-061', 4],
      ['us-pa-009', 5],
      ['us-pa-075', 6],
      ['us-pa-029', 7],
      ['us-pa-011', 8],
      ['us-pa-083', 9],
      ['us-pa-047', 10],
      ['us-pa-005', 11],
      ['us-pa-019', 12],
      ['us-pa-007', 13],
      ['us-pa-067', 14],
      ['us-pa-099', 15],
      ['us-pa-053', 16],
      ['us-pa-123', 17],
      ['us-pa-121', 18],
      ['us-pa-033', 19],
      ['us-pa-063', 20],
      ['us-pa-107', 21],
      ['us-pa-079', 22],
      ['us-pa-055', 23],
      ['us-pa-001', 24],
      ['us-pa-089', 25],
      ['us-pa-069', 26],
      ['us-pa-093', 27],
      ['us-pa-081', 28],
      ['us-pa-095', 29],
      ['us-pa-025', 30],
      ['us-pa-065', 31],
      ['us-pa-003', 32],
      ['us-pa-129', 33],
      ['us-pa-021', 34],
      ['us-pa-013', 35],
      ['us-pa-039', 36],
      ['us-pa-023', 37],
      ['us-pa-097', 38],
      ['us-pa-043', 39],
      ['us-pa-077', 40],
      ['us-pa-091', 41],
      ['us-pa-131', 42],
      ['us-pa-113', 43],
      ['us-pa-037', 44],
      ['us-pa-045', 45],
      ['us-pa-119', 46],
      ['us-pa-087', 47],
      ['us-pa-031', 48],
      ['us-pa-085', 49],
      ['us-pa-071', 50],
      ['us-pa-049', 51],
      ['us-pa-041', 52],
      ['us-pa-127', 53],
      ['us-pa-017', 54],
      ['us-pa-059', 55],
      ['us-pa-051', 56],
      ['us-pa-101', 57],
      ['us-pa-103', 58],
      ['us-pa-115', 59],
      ['us-pa-125', 60],
      ['us-pa-105', 61],
      ['us-pa-109', 62],
      ['us-pa-111', 63],
      ['us-pa-057', 64],
      ['us-pa-073', 65],
      ['us-pa-133', 66]
  ];
  var geochart = Highcharts.mapChart(id, {
      chart: {
          map: 'countries/us/us-pa-all'
      },
      title: {
          text: null
      },
      subtitle: {
          text: title
      },

      mapNavigation: {
          enabled: false,
          buttonOptions: {
              verticalAlign: 'bottom'
          }
      },

      colorAxis: {
          min: 0
      },

      series: [{
          data: data,
          name: 'Random data',
          states: {
              hover: {
                  color: '#BADA55'
              }
          },
          dataLabels: {
              enabled: true,
              format: '{point.name}'
          }
      }]
  });
}

</script>

{% endblock %}
